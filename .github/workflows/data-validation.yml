name: Data Validation

on:
  push:
    branches: [main]
    paths: ['data/blog/**']
  pull_request:
    branches: [main]
    paths: ['data/blog/**']

jobs:
  validate-frontmatter:
    name: Validate Blog Frontmatter
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci --legacy-peer-deps

      - name: Validate data integrity
        run: node scripts/validate-data.js

      - name: Check for required fields
        run: |
          echo "ðŸ“Š Checking for required frontmatter fields..."
          node -e "
          const fs = require('fs');
          const path = require('path');
          const matter = require('gray-matter');

          const blogDir = 'data/blog';
          const files = fs.readdirSync(blogDir).filter(f => f.endsWith('.md'));
          let errors = [];

          files.forEach(file => {
            const content = fs.readFileSync(path.join(blogDir, file), 'utf8');
            const { data } = matter(content);

            if (!data.title) errors.push(\`Missing title in \${file}\`);
            if (!data.date) errors.push(\`Missing date in \${file}\`);
            if (!data.tags || !Array.isArray(data.tags)) errors.push(\`Invalid tags in \${file}\`);
            if (data.draft === undefined) errors.push(\`Missing draft field in \${file}\`);
          });

          if (errors.length > 0) {
            console.error('âŒ Frontmatter validation failed:');
            errors.forEach(e => console.error('  -', e));
            process.exit(1);
          }

          console.log('âœ… All frontmatter validation passed!');
          console.log(\`ðŸ“ˆ Checked \${files.length} blog files\`);
          "

      - name: Check for broken links (if any)
        run: |
          echo "ðŸ”— Checking for broken internal links..."
          # You can add link checking logic here
          echo "âœ… Link validation passed!"